"use strict";(self["webpackChunkeduardo_app"]=self["webpackChunkeduardo_app"]||[]).push([[835],{3835:function(t,e,s){s.r(e),s.d(e,{default:function(){return ft}});var c=s(3396),o=s(7139),a=s(9242),i=s(3946);const n=t=>((0,c.dD)("data-v-38ff37b9"),t=t(),(0,c.Cn)(),t),l={class:"navbar-wrapper"},r={class:"container-fluid padding-bottom-3x mb-1"},d={class:"table-responsive"},u={class:"table"},h=n((()=>(0,c._)("thead",null,[(0,c._)("tr",null,[(0,c._)("th",{class:"text-center"},"Select"),(0,c._)("th",{class:"text-center"},"Product Name"),(0,c._)("th",{class:"text-center"},"Quantity"),(0,c._)("th",{class:"text-center"},"Price"),(0,c._)("th",{class:"text-center"},"Total Price"),(0,c._)("th",{class:"text-center"},"Action")])],-1))),m={class:"align-middle text-center"},p=["value","onChange","checked"],_={class:"align-middle"},g={class:"product-item"},f=["src"],y={class:"product-info"},k={class:"product-title"},w={class:"align-middle text-center"},b={class:"count-input"},C=["onClick","disabled"],I=n((()=>(0,c._)("i",{class:"fas fa-minus"},null,-1))),P=[I],v={class:"quantity"},x=["onClick","disabled"],S=n((()=>(0,c._)("i",{class:"fas fa-plus"},null,-1))),q=[S],M={class:"align-middle text-center text-lg text-medium"},T={class:"align-middle text-center text-lg text-medium"},D={class:"align-middle text-center"},G=["onClick"],E=n((()=>(0,c._)("i",{class:"fa fa-trash"},null,-1))),Q=[E],z={class:"floating-container"},Z={class:"column invoice-section"},N=n((()=>(0,c._)("h4",null,"Payment Details:",-1))),U={class:"table"},$=n((()=>(0,c._)("thead",null,[(0,c._)("tr",null,[(0,c._)("th",null,"Product Name"),(0,c._)("th",null,"Price")])],-1))),F=n((()=>(0,c._)("h4",null,"Total:",-1))),O={class:"text-medium"},j={class:"column checkout-button-section"},R={class:"payment-form"},H=n((()=>(0,c._)("h4",null,"Select Payment Method:",-1))),K=n((()=>(0,c._)("h4",null,"Upload Fullpayment Proof:",-1))),Y={class:"d-flex align-items-center mb-3"},A={class:"col-md-6"},W={class:"col-md-3 ms-2"},J=n((()=>(0,c._)("i",{class:"fas fa-qrcode"},null,-1))),L={class:"column checkout-products-section"},V=n((()=>(0,c._)("h4",null,"Checkout Products:",-1))),B={class:"table"},X=n((()=>(0,c._)("thead",null,[(0,c._)("tr",null,[(0,c._)("th",{class:"text-center"},"Product Name"),(0,c._)("th",{class:"text-center"},"Price"),(0,c._)("th",{class:"text-center"},"Quantity"),(0,c._)("th",{class:"text-center"},"Total Price")])],-1))),tt={key:1,class:"modal fade show",tabindex:"-1",style:{display:"block"}},et={class:"modal-dialog modal-dialog-centered"},st={class:"modal-content"},ct={class:"modal-header"},ot=n((()=>(0,c._)("h5",{class:"modal-title"},"Scan GCash QR Code",-1))),at=n((()=>(0,c._)("span",{"aria-hidden":"true"},"Ã—",-1))),it=[at],nt=n((()=>(0,c._)("div",{class:"modal-body text-center"},[(0,c._)("div",{class:"img-container"},[(0,c._)("img",{src:i,alt:"GCash QR Code",class:"img-fluid",style:{"max-width":"100%",height:"auto"}})])],-1))),lt={class:"modal-footer"};function rt(t,e,s,i,n,I){const S=(0,c.up)("Top"),E=(0,c.up)("navbar"),at=(0,c.up)("Notification");return(0,c.wg)(),(0,c.iD)("div",null,[(0,c.Wm)(S),(0,c._)("div",l,[(0,c.Wm)(E)]),(0,c._)("div",r,[n.deleteSuccess?((0,c.wg)(),(0,c.j4)(at,{key:0,show:n.deleteSuccess,type:"success",message:"Deleted successfully!"},null,8,["show"])):(0,c.kq)("",!0),(0,c._)("div",d,[(0,c._)("table",u,[h,(0,c._)("tbody",null,[((0,c.wg)(!0),(0,c.iD)(c.HY,null,(0,c.Ko)(n.cart,(t=>((0,c.wg)(),(0,c.iD)("tr",{key:t.shop_id},[(0,c._)("td",m,[(0,c._)("input",{type:"checkbox",value:t.cart_id,onChange:e=>I.toggleSelection(t.cart_id),checked:I.isChecked(t.cart_id)},null,40,p)]),(0,c._)("td",_,[(0,c._)("div",g,[(0,c._)("img",{class:"img-fluid menu",src:`https://eduardos-resort.online/backend/backend/public/uploads/${I.getImg(t).prod_img}`,alt:"Product"},null,8,f),(0,c._)("div",y,[(0,c._)("h4",k,(0,o.zw)(I.getInfo(t).prod_name),1)])])]),(0,c._)("td",w,[(0,c._)("div",b,[(0,c._)("button",{onClick:e=>I.updateQuantity(t,"decrement"),class:"btn btn-primary btn-sm rounded-circle",disabled:t.quantity<=1},P,8,C),(0,c._)("span",v,(0,o.zw)(t.quantity),1),(0,c._)("button",{onClick:e=>I.updateQuantity(t,"increment"),class:"btn btn-primary btn-sm rounded-circle",disabled:t.quantity>=I.getMaxQuantity(t)},q,8,x)])]),(0,c._)("td",M,(0,o.zw)(I.getPrice(t).prod_price),1),(0,c._)("td",T,(0,o.zw)(I.getTotal(t)),1),(0,c._)("td",D,[(0,c._)("button",{onClick:e=>I.deleteCart(t.cart_id),class:"btn-trash btn-danger"},Q,8,G)])])))),128))])])]),(0,c._)("div",z,[(0,c._)("div",Z,[N,(0,c._)("table",U,[$,(0,c._)("tbody",null,[((0,c.wg)(!0),(0,c.iD)(c.HY,null,(0,c.Ko)(n.checkedItems,(t=>((0,c.wg)(),(0,c.iD)("tr",{key:t},[(0,c._)("td",null,(0,o.zw)(I.getInfo(I.getCartItem(t)).prod_name),1),(0,c._)("td",null,"Php."+(0,o.zw)(I.getPrice(I.getCartItem(t)).prod_price),1)])))),128))])]),(0,c._)("div",null,[F,(0,c.Uk)(),(0,c._)("span",O,"Php."+(0,o.zw)(I.calculateSubtotal()),1)])]),(0,c._)("div",j,[(0,c._)("div",R,[H,(0,c._)("div",null,[(0,c._)("label",null,[(0,c.wy)((0,c._)("input",{type:"radio","onUpdate:modelValue":e[0]||(e[0]=t=>n.paymentMethod=t),value:"gcash"},null,512),[[a.G2,n.paymentMethod]]),(0,c.Uk)(" GCash ")])]),K,(0,c._)("div",Y,[(0,c._)("div",A,[(0,c._)("input",{type:"file",onChange:e[1]||(e[1]=(...t)=>I.handleFileUpload&&I.handleFileUpload(...t)),accept:"image/*",class:"form-control",required:""},null,32)]),(0,c._)("div",W,[(0,c._)("button",{type:"button",class:"btn-gcash btn-info w-100",onClick:e[2]||(e[2]=(...t)=>I.openGcashQRCode&&I.openGcashQRCode(...t))},[J,(0,c.Uk)(" GCASH ")])])]),(0,c._)("a",{class:"btn btn-dark",onClick:e[3]||(e[3]=(...t)=>I.checkout&&I.checkout(...t))},"Proceed to Checkout")])]),(0,c._)("div",L,[V,(0,c._)("table",B,[X,(0,c._)("tbody",null,[((0,c.wg)(!0),(0,c.iD)(c.HY,null,(0,c.Ko)(n.checkedOutProducts,(t=>((0,c.wg)(),(0,c.iD)("tr",{key:t.cart_id},[(0,c._)("td",null,(0,o.zw)(I.getInfo(t).prod_name),1),(0,c._)("td",null,"Php."+(0,o.zw)(I.getPrice(t).prod_price),1),(0,c._)("td",null,(0,o.zw)(t.quantity),1),(0,c._)("td",null,"Php."+(0,o.zw)(I.getTotal(t)),1)])))),128))])])])]),n.showGcashModal?((0,c.wg)(),(0,c.iD)("div",tt,[(0,c._)("div",et,[(0,c._)("div",st,[(0,c._)("div",ct,[ot,(0,c._)("button",{type:"button",class:"close",onClick:e[4]||(e[4]=(...t)=>I.closeGcashModal&&I.closeGcashModal(...t)),"aria-label":"Close"},it)]),nt,(0,c._)("div",lt,[(0,c._)("button",{type:"button",class:"btn btn-secondary",onClick:e[5]||(e[5]=(...t)=>I.closeGcashModal&&I.closeGcashModal(...t))},"Close")])])])])):(0,c.kq)("",!0),n.insufficientStockError?((0,c.wg)(),(0,c.j4)(at,{key:2,show:n.insufficientStockError,type:"error",message:"Insufficient stock for one or more items"},null,8,["show"])):(0,c.kq)("",!0),n.notification.show?((0,c.wg)(),(0,c.j4)(at,{key:3,show:n.notification.show,type:n.notification.type,message:n.notification.message},null,8,["show","type","message"])):(0,c.kq)("",!0),n.checkoutSuccess?((0,c.wg)(),(0,c.j4)(at,{key:4,show:n.checkoutSuccess,type:"success",message:"Checkout successful!"},null,8,["show"])):(0,c.kq)("",!0),n.checkoutError?((0,c.wg)(),(0,c.j4)(at,{key:5,show:n.checkoutError,type:"error",message:"Please select items before proceeding with the checkout."},null,8,["show"])):(0,c.kq)("",!0)])])}s(560);var dt=s(1076),ut=s(1738),ht=s(5818),mt=s(9754),pt={name:"cart",components:{Top:ut.Z,navbar:ht.Z,Notification:mt.Z},data(){return{showGcashModal:!1,paymentMethod:null,downpaymentProof:null,cartCheckedOutIds:[],checkedOutProducts:[],cart:[],deleteSuccess:!1,prod_name:[],prod_price:[],prod_img:[],user:null,checkedItems:[],checkoutSuccess:!1,checkoutError:!1,insufficientStockError:!1,notification:{show:!1,type:"",message:""}}},mounted(){this.getCart(),this.getInfo(),this.getPrice(),this.getImg()},methods:{handleFileUpload(t){this.downpaymentProof=t.target.files[0]},openGcashQRCode(){this.showGcashModal=!0},closeGcashModal(){this.showGcashModal=!1},toggleSelection(t){const e=this.checkedItems.indexOf(t);-1===e?this.checkedItems.push(t):this.checkedItems.splice(e,1)},isChecked(t){return this.checkedItems.includes(t)},async checkout(){try{const t=sessionStorage.getItem("id");if(0===this.checkedItems.length)return console.warn("No items selected for checkout."),this.checkoutError=!0,void setTimeout((()=>{this.checkoutError=!1}),3e3);if(!this.paymentMethod)return console.warn("Please select a payment method."),this.notification={show:!0,type:"error",message:"Please select a payment method."},void setTimeout((()=>{this.notification={show:!1,type:"",message:""}}),3e3);const e=this.checkedItems.map((t=>{const e=this.cart.find((e=>e.cart_id===t)),s=e?e.shop_id:null;return{shop_id:s,quantity:e?e.quantity:0,total_price:this.getTotal(e)}})),s={id:t,status:"pending",total_price:parseFloat(this.calculateSubtotal()),items:e,order_payment_method:this.paymentMethod},c=new FormData;c.append("orderData",JSON.stringify(s)),this.downpaymentProof&&c.append("downpayment_proof",this.downpaymentProof);const o=await dt.Z.post("checkout",c,{headers:{"Content-Type":"multipart/form-data"}});if(400===o.status)return console.warn("Insufficient stock for one or more items"),this.notification={show:!0,type:"error",message:"Insufficient stock for one or more items"},void setTimeout((()=>{this.notification={show:!1,type:"",message:""}}),3e3);if(200===o.status){o.data.invoice_id;const t=this.cart.filter((t=>this.checkedItems.includes(t.cart_id)));this.checkedOutProducts.push(...t),this.cart=this.cart.filter((t=>!this.checkedItems.includes(t.cart_id))),this.checkoutSuccess=!0,this.paymentMethod=null,this.downpaymentProof=null,setTimeout((()=>{this.checkoutSuccess=!1,this.checkedItems=[]}),2e3)}else console.error("Checkout failed:",o.data.message)}catch(t){console.error("Checkout Error:",t)}},handlePaymentSelection(t){this.paymentMethod=t},getCartItem(t){return this.cart.find((e=>e.cart_id===t))||{}},async getCart(){const t=sessionStorage.getItem("id");try{const[e,s,c]=await Promise.all([dt.Z.get(`/getProd/${t}`),dt.Z.get("/getData"),dt.Z.get("/getShop")]);this.cart=e.data.map((t=>({...t,selected:!1}))),this.data=s.data,this.prod_name=c.data,this.prod_price=c.data,this.prod_img=c.data}catch(e){console.error("Error fetching cart:",e)}},getInfo(t){const e=this.prod_name.find((e=>e.shop_id===t.shop_id))||{};return console.log(`Product Name: ${e.prod_name}, Price: ${e.prod_price}`),e},getPrice(t){return this.prod_price.find((e=>e.shop_id===t.shop_id))||{}},getImg(t){return this.prod_img.find((e=>e.shop_id===t.shop_id))||{}},async deleteCart(t){const e=await new Promise((t=>{const e=window.confirm("Do you want to DELETE this item?");t(e),this.deleteSuccess=!0,setTimeout((()=>{this.deleteSuccess=!1}),2e3)}));if(e)try{await dt.Z.post("del",{cart_id:t}),this.cart=this.cart.filter((e=>e.cart_id!==t)),this.deleteSuccess=!0,setTimeout((()=>{this.deleteSuccess=!1}),2e3)}catch(s){console.error("Error deleting item:",s)}},getMaxQuantity(t){const e=this.getInfo(t);return e.prod_quantity||0},updateQuantity(t,e){"increment"===e&&t.quantity<this.getMaxQuantity(t)?t.quantity++:"decrement"===e&&t.quantity>1&&t.quantity--,this.updateTotalPrice(t)},updateTotalPrice(t){const e=this.getInfo(t);e.prod_price,t.quantity;dt.Z.post("/updateCartQuantity",{cart_id:t.cart_id,quantity:t.quantity}).then((t=>{console.log(t.data)})).catch((t=>{console.error("Error updating quantity:",t)}))},getTotal(t){const e=this.getInfo(t);return(e.prod_price||0)*t.quantity},calculateSubtotal(){const t=this.checkedItems.reduce(((t,e)=>{const s=this.cart.find((t=>t.cart_id===e));if(s){const c=this.getInfo(s),o=(c.prod_price||0)*s.quantity;return console.log(`Cart ID: ${e}, Product Name: ${c.prod_name}, Price: ${c.prod_price}, Item Total: ${o}`),t+o}return t}),0).toFixed(2);return console.log("Selected Items:",this.checkedItems),t},check(t){const e=this.checkedItems.indexOf(t);this.checkedItems=-1===e?[...this.checkedItems,t]:this.checkedItems.filter((e=>e!==t)),console.log("Selected Items:",this.checkedItems)},getcheckedItems(){return this.cart.filter((t=>t.selected))}}},_t=s(89);const gt=(0,_t.Z)(pt,[["render",rt],["__scopeId","data-v-38ff37b9"]]);var ft=gt}}]);
//# sourceMappingURL=835.7cb539de.js.map